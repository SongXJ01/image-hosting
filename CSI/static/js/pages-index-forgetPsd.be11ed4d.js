(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-forgetPsd"],{6131:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return s}));var s={uInput:a("b4e3").default,uToast:a("5d05").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"bg-white"},[a("v-uni-view",{staticClass:"fixed"},[a("cu-custom",{attrs:{isBack:!0,bgColor:"text-white"}},[a("template",{attrs:{slot:"backText"},slot:"backText"},[t._v("返回")]),a("template",{attrs:{slot:"content"},slot:"content"},[t._v("修改密码")])],2)],1),a("v-uni-view",{staticClass:"UCenter-bg"},[a("v-uni-image",{staticClass:"png",attrs:{src:"/static/Logo.png",mode:"widthFix"}}),a("v-uni-image",{staticClass:"gif-wave",attrs:{src:"/static/wave.gif",mode:"scaleToFill"}})],1),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"padding margin-top-xl "},[a("v-uni-view",{staticClass:"padding myBorder"},[a("v-uni-view",{staticClass:"text-bold text-center text-xl margin-top"},[t._v("重置密码")]),a("v-uni-view",{staticClass:"content margin"},[a("u-input",{staticClass:"margin",attrs:{placeholder:"请输入邮箱",type:"email",border:t.border},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("v-uni-view",{staticClass:"cu-form-group"},[a("u-input",{attrs:{placeholder:"请输入验证码",type:"number",border:t.border},model:{value:t.vCode,callback:function(e){t.vCode=e},expression:"vCode"}}),t.vCodeStatus?a("v-uni-button",{staticClass:"cu-btn shadow margin-left-sm bg-grey",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendYzm.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-loading2 cuIconfont-spin margin-right-sm"}),t._v(t._s(t.vCodeShow)+" s")],1):a("v-uni-button",{staticClass:"cu-btn shadow margin-left-sm bg-green",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendYzm.apply(void 0,arguments)}}},[t._v(t._s(t.vCodeShow))])],1),a("u-input",{staticClass:"margin",attrs:{placeholder:"请输入密码",type:"password",border:t.border},model:{value:t.psd1,callback:function(e){t.psd1=e},expression:"psd1"}}),a("u-input",{staticClass:"margin",attrs:{placeholder:"请再次输入密码",type:"password",border:t.border},model:{value:t.psd2,callback:function(e){t.psd2=e},expression:"psd2"}})],1),a("v-uni-view",{staticClass:"padding text-center grid col-3 align-center"},[a("v-uni-view"),a("v-uni-button",{staticClass:"padding cu-btn round bg-gradual-blue shadow lg margin-tb",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isHuman()}}},[t._v("确定重置")])],1)],1)],1),a("v-uni-view",{staticClass:"cu-modal",class:"ModalVerify"==t.modalName?"show":""},[a("v-uni-view",{staticClass:"cu-dialog bg-white padding"},[a("move-verify",{ref:"verifyElement",on:{result:function(e){arguments[0]=e=t.$handleEvent(e),t.verifyResult.apply(void 0,arguments)}}})],1)],1),a("u-toast",{ref:"uToast"}),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-tabbar-height"}),a("v-uni-view",{staticClass:"cu-tabbar-height"})],1)},n=[]},"7e0b":function(t,e,a){"use strict";a.r(e);var s=a("fa2b"),i=a.n(s);for(var n in s)"default"!==n&&function(t){a.d(e,t,(function(){return s[t]}))}(n);e["default"]=i.a},"8e0c":function(t,e,a){"use strict";a.r(e);var s=a("6131"),i=a("7e0b");for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);var o,r=a("f0c5"),u=Object(r["a"])(i["default"],s["b"],s["c"],!1,null,"44eb86c2",null,!1,s["a"],o);e["default"]=u.exports},fa2b:function(t,e,a){"use strict";(function(t){var s=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(a("513f")),n=a("2f62"),o={components:{"move-verify":i.default},computed:(0,n.mapState)({user:function(t){return t.user}}),onLoad:function(){t("log","(测试VueX连接) 云存储路径：",this.$store.state.cloudPath," at pages/index/forgetPsd.vue:81"),t("log","(测试VueX连接) 用户名：",this.user.loginname," at pages/index/forgetPsd.vue:82")},onHide:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},data:function(){return{email:"",vCode:"",vCodeStatus:!1,vCodeShow:"获取验证码",psd1:"",psd2:"",border:!0,modalName:"",timer:null,verifyRes:this.$store.state.isHuman}},methods:{sendYzm:function(){var e=this;this.vCodeStatus||(uni.showLoading({title:"正在获取验证码"}),uni.request({url:this.$store.state.apiPath+"/user/sendYzm",method:"POST",data:{email:this.email},success:function(a){uni.hideLoading(),t("log","请求 sendYzm 接口成功",a," at pages/index/forgetPsd.vue:121"),"发送成功"==a.data.desc?(e.$refs.uToast.show({title:a.data.desc,type:"success"}),e.vCodeStatus=!0,e.vCodeShow=60,e.timer=setInterval((function(){e.vCodeShow>0?e.vCodeShow=e.vCodeShow-1:(clearTimeout(e.timer),e.timer=null,e.vCodeStatus=!1,e.vCodeShow="重新获取验证码")}),1e3)):e.$refs.uToast.show({title:a.data.desc,type:"error"})},fail:function(e){t("log","请求 sendYzm 接口失败"," at pages/index/forgetPsd.vue:148")}}))},verifyResult:function(e){t("log",e.flag," at pages/index/forgetPsd.vue:157"),e.flag&&(this.modalName="",this.verifyRes=!0,this.$store.state.isHuman=!0,this.register(),this.$refs.verifyElement.reset())},isHuman:function(){this.verifyRes?this.register():this.modalName="ModalVerify"},register:function(){var e=this;this.verification()&&(uni.showLoading({title:"正在重置密码"}),uni.request({url:this.$store.state.apiPath+"/user/changePassword",method:"POST",data:{email:this.email,password:this.psd1,yzm:this.vCode},success:function(a){uni.hideLoading(),t("log","请求 changePassword 接口成功",a," at pages/index/forgetPsd.vue:193"),"修改密码成功"==a.data.desc?(e.user.loginname=a.data.data.loginname,e.user.email=a.data.data.email,e.user.status=a.data.data.status,e.user.username=a.data.data.username,e.$refs.uToast.show({title:a.data.desc,type:"success"}),uni.navigateTo({url:"../index/login"})):e.$refs.uToast.show({title:a.data.desc,type:"error"})},fail:function(e){t("log","请求 changePassword 接口失败"," at pages/index/forgetPsd.vue:215")}}))},verification:function(){var t=/^(\w+((-\w+)|(\.\w+))*)\+\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;if(!t.test(this.email))return this.$refs.uToast.show({title:"邮箱格式不合法",type:"error"}),!1;var e=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;return!!e.test(this.psd1)||(this.$refs.uToast.show({title:"请输入(6-16位)数字和字母组合",type:"error"}),!1)}}};e.default=o}).call(this,a("0de9")["log"])}}]);